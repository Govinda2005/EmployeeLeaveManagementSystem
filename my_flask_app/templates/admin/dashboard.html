{% extends "layout/base.html" %} {% block title %}Admin Dashboard - User
Management & Reports{% endblock %} {% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h1><i class="fas fa-user-cog me-2"></i>Admin Dashboard</h1>
  <a href="{{ url_for('admin.add_user') }}" class="btn btn-primary">
    <i class="fas fa-user-plus me-1"></i> Add New User
  </a>
</div>

<!-- User Table -->
<div class="card mb-4">
  <div class="card-header">
    <h5 class="mb-0"><i class="fas fa-users me-2"></i>All Users</h5>
  </div>
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Role</th>
            <th>Manager</th>
            <th>Active</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for user in users.items %}
          <tr>
            <td>{{ user.id }}</td>
            <td>{{ user.full_name }}</td>
            <td>{{ user.email }}</td>
            <td>{{ user.role.value.title() }}</td>
            <td>
              {% if user.manager %} {{ user.manager.full_name }} {% else %} — {%
              endif %}
            </td>
            <td>
              {% if user.is_active %}
              <span class="badge bg-success">Yes</span>
              {% else %}
              <span class="badge bg-secondary">No</span>
              {% endif %}
            </td>
            <td>
              <a
                href="{{ url_for('admin.edit_user', user_id=user.id) }}"
                class="btn btn-sm btn-outline-primary"
                title="Edit"
              >
                <i class="fas fa-edit"></i>
              </a>
              <a
                href="{{ url_for('admin.delete_user', user_id=user.id) }}"
                class="btn btn-sm btn-outline-danger"
                onclick="return confirm('Delete user {{ user.full_name }}?');"
                title="Delete"
              >
                <i class="fas fa-trash-alt"></i>
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <nav aria-label="User pagination">
      <ul class="pagination justify-content-center">
        {% if users.has_prev %}
        <li class="page-item">
          <a
            class="page-link"
            href="{{ url_for('admin.manage_users', page=users.prev_num) }}"
            >Previous</a
          >
        </li>
        {% else %}
        <li class="page-item disabled">
          <span class="page-link">Previous</span>
        </li>
        {% endif %} {% for page_num in users.iter_pages(left_edge=2,
        right_edge=2) %} {% if page_num %}
        <li class="page-item {% if page_num == users.page %}active{% endif %}">
          <a
            class="page-link"
            href="{{ url_for('admin.manage_users', page=page_num) }}"
          >
            {{ page_num }}
          </a>
        </li>
        {% else %}
        <li class="page-item disabled"><span class="page-link">…</span></li>
        {% endif %} {% endfor %} {% if users.has_next %}
        <li class="page-item">
          <a
            class="page-link"
            href="{{ url_for('admin.manage_users', page=users.next_num) }}"
            >Next</a
          >
        </li>
        {% else %}
        <li class="page-item disabled"><span class="page-link">Next</span></li>
        {% endif %}
      </ul>
    </nav>
  </div>
</div>

<!-- Reports Panel -->
<div class="card">
  <div class="card-header">
    <h5 class="mb-0">
      <i class="fas fa-chart-bar me-2"></i>Generate Leave Reports
    </h5>
  </div>
  <div class="card-body">
    <form
      method="POST"
      action="{{ url_for('admin.reports') }}"
      class="row g-3 align-items-end"
      id="reportForm"
    >
      {{ form.hidden_tag() }}

      <!-- Report Type -->
      <div class="col-md-3">
        {{ form.report_type.label(class="form-label") }} {{
        form.report_type(class="form-select", id="reportType") }}
      </div>

      <!-- Month (for monthly reports) -->
      <div class="col-md-2" id="monthField">
        {{ form.month.label(class="form-label") }} {{
        form.month(class="form-select") }}
      </div>

      <!-- Year (for monthly reports) -->
      <div class="col-md-2" id="yearField">
        {{ form.year.label(class="form-label") }} {{
        form.year(class="form-select") }}
      </div>

      <!-- Team Manager (for team reports) -->
      <div class="col-md-3" id="managerField">
        {{ form.team_manager.label(class="form-label") }} {{
        form.team_manager(class="form-select") }}
      </div>

      <!-- Employee (for user reports) -->
      <div class="col-md-2" id="employeeField">
        {{ form.employee.label(class="form-label") }} {{
        form.employee(class="form-select") }}
      </div>

      <!-- Format -->
      <div class="col-md-2">
        {{ form.format.label(class="form-label") }} {{
        form.format(class="form-select") }}
      </div>

      <!-- Submit Button -->
      <div class="col-md-2">
        <button type="submit" class="btn btn-primary w-100">
          <i class="fas fa-download me-1"></i> Generate
        </button>
      </div>
    </form>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const reportType = document.getElementById("reportType");
    const monthField = document.getElementById("monthField");
    const yearField = document.getElementById("yearField");
    const managerField = document.getElementById("managerField");
    const employeeField = document.getElementById("employeeField");

    function toggleFields() {
      const selectedType = reportType.value;

      // Hide all conditional fields first
      monthField.style.display = "none";
      yearField.style.display = "none";
      managerField.style.display = "none";
      employeeField.style.display = "none";

      // Show relevant fields based on report type
      if (selectedType === "monthly") {
        monthField.style.display = "block";
        yearField.style.display = "block";
      } else if (selectedType === "team") {
        managerField.style.display = "block";
      } else if (selectedType === "user") {
        employeeField.style.display = "block";
      }
    }

    // Initialize field visibility
    toggleFields();

    // Add event listener for report type changes
    reportType.addEventListener("change", toggleFields);
  });
</script>

{% endblock %}
